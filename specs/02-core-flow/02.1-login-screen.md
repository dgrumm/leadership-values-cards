# Feature Spec: 02.1 - Login Screen

## Overview
Welcome screen where users can create new sessions or join existing ones using 6-character codes.

## User Story
As a user, I can quickly start a new session or join an existing one with just my name and a session code.

## Technical Requirements

### UI Components
- [x] Centered card layout with application title
- [x] "Your Name" text input field
- [x] "Session Code" 6-character input field with generate icon (⚙️)
- [x] Single "Join Session ➜" button (handles both join and create scenarios)
- [x] Settings icon for generating new session codes
- [x] Error message display area

### Input Validation
- [x] Name: 1-50 characters, alphanumeric + spaces + hyphens
- [x] Session code: exactly 6 alphanumeric characters
- [x] Auto-uppercase session code input
- [x] Real-time validation feedback
- [x] Form submission only when valid

### Session Code Generation
- [x] Settings icon generates random 6-character code
- [x] Display generated code in session code field
- [x] Visual feedback when code is generated
- [x] Ensure generated codes don't conflict with active sessions

### Data Persistence
- [x] Save name and session code to sessionStorage
- [x] Pre-populate fields from sessionStorage on return visits
- [x] Clear sessionStorage on successful session join
- [x] URL parameter support overrides sessionStorage

### Simplified Join/Create Flow
- [x] Single "Join Session ➜" button handles both scenarios intelligently:
  - If session exists: Join as additional participant
  - If session doesn't exist: Create new session with that code, become first participant
- [x] Always successful unless session full, expired, or network error
- [x] Successful join/create redirects to `/canvas?session=[CODE]&name=[NAME]`
- [x] Form validation requires both name and session code
- [x] Browser back button returns to empty form

### Navigation
- [x] Successful join/create redirects to canvas with session info
- [x] Reduced error scenarios (no "session not found" errors)
- [x] Form remains populated after genuine errors (network, validation)

## Layout Specifications
```
┌─────────────────────────────────────────────┐
│                                        ⚙️   │
│                                             │
│         Welcome to Leadership Values       │
│              Cards Exercise                 │
│                                             │
│    ┌─────────────────────────────────────┐  │
│    │ Your Name:                          │  │
│    │ ________________________           │  │
│    │                                     │  │
│    │ Session Code:                       │  │
│    │ ________________________           │  │
│    │                                     │  │
│    │        [Join Session ➜]            │  │
│    └─────────────────────────────────────┘  │
│                                             │
│              [Error message]                │
│                                             │
└─────────────────────────────────────────────┘
```

## Error Messages (Simplified)
| Scenario | Message | Styling |
|----------|---------|---------|
| Empty name | "Please enter your name" | Red text below form |
| Invalid code | "Session code must be 6 letters/numbers" | Red text below form |
| Session full | "Session is full (50 participants max). Try another code." | Red background alert |
| Connection error | "Unable to connect. Please check your internet connection." | Red background alert |

**Removed Error Cases:**
- ~~Session not found~~ → Now creates new session automatically
- ~~Session ended~~ → Now creates new session with same code automatically

## Interaction Patterns
- [x] Enter key submits form when valid
- [x] Tab navigation between fields
- [x] Settings icon shows hover state
- [x] Button shows loading state during submission
- [x] Session code input auto-formats (uppercase, no spaces)
- [x] Name field trims whitespace automatically

## Validation Rules
```javascript
const validateName = (name) => {
  return name.trim().length >= 1 && name.trim().length <= 50;
};

const validateSessionCode = (code) => {
  return /^[A-Z0-9]{6}$/.test(code.toUpperCase());
};
```

## Accessibility
- [x] Proper form labels and ARIA attributes
- [x] Keyboard navigation support
- [x] Screen reader announcements for errors
- [x] Focus management after errors
- [x] High contrast support

## Acceptance Criteria
- [x] Can generate new session codes via settings icon
- [x] Form validates inputs before submission (both name and session code required)
- [x] Single "Join Session ➜" button intelligently joins existing or creates new session
- [x] No "session not found" errors - always successful for valid inputs
- [x] Simplified error handling (4 scenarios instead of 6)
- [x] sessionStorage persists data across browser tabs
- [x] URL parameters override sessionStorage values
- [x] Loading states prevent double submission
- [x] Successful join/create redirects to canvas

## Test Cases (Updated)
1. Generate new session code and auto-create new session
2. Join existing session with valid shared code  
3. Try to join non-existent session code (should create new session)
4. Test input validation (empty name, invalid code length)
5. Test error handling (session full, connection failure)
6. Verify sessionStorage persistence and clearing
7. Test URL parameter override behavior
8. Test keyboard navigation and accessibility
9. Verify form submission prevents duplicates
10. Verify always-successful flow (no "session not found" errors)

## Dependencies
- 01.2 Session Management ✓

## Status: 🟢 Complete + Code Reviewed

## Implementation Notes
- **Simplified Join/Create Flow**: Single "Join Session ➜" button intelligently handles both scenarios
- **Atomic Session Logic**: Race-condition-free session creation with atomic join-or-create API
- **Performance Optimized**: Debounced validation (300ms) and proper memory leak prevention  
- **Request Timeout**: 10-second timeout prevents hanging requests
- **Reduced Error States**: 4 error scenarios instead of 6 (eliminated "session not found")
- **Always Successful**: Valid inputs always result in successful session entry
- Login form with real-time validation implemented
- Session code generation with collision detection
- Name conflict resolution with auto-append numbering  
- SessionStorage persistence for browser tab duration with cross-tab sync
- Smooth animations and loading states
- Full header system ready for canvas pages
- Personalized deck animation after successful login
- All wireframe specifications matched exactly
- **Code Review Addressed**: Fixed race conditions, memory leaks, added proper cleanup

## Key Files Implemented
- `/components/LoginForm.tsx` - Simplified single-button login interface
- `/components/ui/SessionCodeInput.tsx` - 6-char code input with generator
- `/hooks/useSessionJoin.ts` - **Updated**: Intelligent join/create with `joinOrCreateSession()` method
- `/hooks/useFormValidation.ts` - Real-time validation (both fields required)
- `/hooks/useSessionStorage.ts` - Browser tab persistence
- `/lib/session/session-manager.ts` - **Updated**: Added `createSessionWithCreator()` and custom code support
- `/lib/session/session-store.ts` - **Updated**: Custom session code validation and creation
- `/app/api/sessions/route.ts` - **Updated**: Create-with-creator API endpoint
- `/components/header/SessionHeader.tsx` - Full header with navigation
- `/components/WelcomeScreen.tsx` - Post-login animation screen
- Full UI component library with loading states and validation styling

## Test Coverage
- Unit tests for validation utilities and session management
- Comprehensive useSessionJoin hook tests with atomic API behavior
- Integration with enhanced session management API  
- Error handling for all specified scenarios including timeout errors
- Race condition prevention and memory leak testing
- Performance optimized with 10-second timeout requirement
- Cross-browser compatibility with Playwright E2E test suite