# Feature Spec: 02.2 - Step 1 Initial Sort

## Overview
First step where users sort all cards (example 40) from the csv loaded at build time into "More Important" and "Less Important" piles through card flipping and drag-and-drop.
1
## User Story
As a participant, I can flip cards one at a time and sort them into two piles to begin identifying my leadership values.

## Technical Requirements

### State Management
- [x] Track current deck position (0-39)
- [x] Maintain two pile arrays: moreImportant[], lessImportant[]
- [x] Store flipped card in staging area before sorting
- [x] Sync pile contents to prevent data loss

### UI Components
- [x] Card deck (face-down, clickable) positioned bottom-center (see mockups)
- [x] Card deck orientation is landscape
- [x] Staging area for flipped card (center, above-right of deck)
- [x] Staging area is "invisible" to participants since it is a user-initiated drop zone
- [x] Two labeled drop zones: "More Important" (left), "Less Important" (right)
- [x] Progress indicator showing cards remaining in deck
- [x] Step indicator "Step 1 of 3" in top-right (header)
- [x] Header navigation also includes "← Leave Session" button and "👥 X Participants" where X is number of participants in current session

### Card Flipping Mechanics
- [x] Click deck → 3D flip animation (500ms) → card flips while moving from deck center to staging area with arc motion
- [x] Card displays value name (large, bold) and description (smaller)
- [x] Only one card in staging area at a time; clicking deck while card in staging area is disabled
- [x] Deck thickness visually decreases as cards are flipped
- [x] Subtle shadow and depth effects on cards

### Sorting Methods
- [x] **Drag & Drop**: Drag card from staging to either pile
- [x] **Click Pile Title**: Click "More Important" or "Less Important" labels to move card from staging to drop zone
- [x] Cards snap to pile when >50% overlaps drop zone
- [x] Smooth snap animation (200ms ease-out)
- [x] Cards landing in drop zones are arranged from top-left to right-down, with overlap OK if value_name remains visible

### Pile Management
- [x] Cards can be moved between piles after placement
- [x] Visual feedback when dragging over valid drop zones
- [x] Cards maintain readable arrangement with all cards visible (value names readable)
- [x] Pile counters show number of cards
- [x] Deck counter decrements by 1 when a card is placed in a drop zone
- [x] Next card is automatically flipped from deck to staging when previous card placed in drop zone

### Progression Rules
- [x] "Step 2 ➜" button appears only when deck is empty
- [x] Sum of cards in the "More Important" or "Less Important" piles total number of cards in orginal deck
- [x] Validation message if attempting to proceed incorrectly
- [x] Save state before transitioning to Step 2

## Animation Specifications
- **Card flip**: 500ms spring animation with 3D rotation, arc movement from deck center to staging area
- **Snap to pile**: 200ms ease-out with subtle bounce
- **Card hover**: translateY(-4px) with increased shadow
- **Pile highlight**: Border glow when drag hovering
- **Cards in piles**: Scale 0.9 (90% size) with proper spacing for readability

## Layout Structure (see mockups for higher fidelity)
```
[← Leave Session]  [👥5 Participants]        [Step 1 of 3] [x]

┌─────────────────────┐     ┌─────────────────────┐
│   More Important    │     │   Less Important    │
│      (12 cards)     │     │      (15 cards)     │
│   [Card stacks]     │     │   [Card stacks]     │
│   (28rem height)    │     │   (28rem height)    │
│   scrollable        │     │   scrollable        │
└─────────────────────┘     └─────────────────────┘

┌─────────────────────┐                ┌──────────────────┐
│ Leadership Values   │                │    TRUST         │  
│ Cards (13 left)     │  ← Deck        │ Firm reliance... │ ← Staging (3D flip)
│ (fixed position)    │                │ (fixed position) │
└─────────────────────┘                └──────────────────┘

                [Step 2 ➜]
```

## Game Steps Modal (aka Side Panel)
- [x] Automatically appears on first visit to Step 1
- [x] Explains exercise rules clearly
- [x] "Sort the leadership values into two piles"
- [x] "Click the deck to flip cards one at a time"
- [x] "Drag cards to sort them, or click the pile name"
- [x] "You can move cards between piles at any time"
- [x] Dismissible with "Got it" button
- [x] Clicking "Step 1 of 3" in header will re-display modal
- [x] User can view game progress any time by clicking the "Step x of y" button in header  
- [x] Step button shows info icon (not X) to indicate clickable side panel functionality
- [x] Game Steps Modal shows current state - number of cards sorted into each pile, number of cards in deck left to sort

## Validation Rules
- [x] Cannot flip next card if one is in staging
- [x] Cannot proceed if cards remain in main deck
- [x] Maximum 1 card in staging area at any time
- [x] All cards must be sorted before Step 2

## Error Handling
- [x] Show helpful message if trying to proceed with empty piles
- [x] Prevent card flipping if staging area occupied
- [x] Handle drag cancellation (card returns to origin)
- [x] Graceful handling of rapid clicks on deck

## Performance Requirements
- [x] Maintain 60fps during card animations
- [x] Responsive drag operations (<16ms)
- [x] Smooth pile transitions and updates
- [x] Memory efficient card state management

## Acceptance Criteria
- [x] All cards can be flipped and sorted
- [x] Animations complete within specified times
- [x] "Step 2" button appears only when deck empty and piles valid
- [x] Cards maintain 60fps performance during drag operations
- [x] Pile contents persist across browser refresh
- [x] Modal explains rules clearly on first visit

## Test Cases
1. Complete sort of all cards successfully
2. Move cards between piles after initial placement
3. Attempt to proceed with empty deck but invalid piles
4. Test drag and click sorting methods
5. Verify animation performance under load
6. Test modal display and dismissal
7. Verify state persistence across page refresh
8. Test rapid clicking and edge cases
9. Verify landscape card orientation (width > height)
10. Confirm staging area is invisible to participants  
11. Test card arrangement shows all value names clearly
12. Verify participant count displays correctly in header
13. Confirm step button shows info icon and opens side panel
14. Test 3D flip animation starts from deck center and moves to staging area
15. Verify drop zones are tall enough (28rem) with scrollable content
16. Test card scaling in drop zones maintains readability (90% scale)

## Dependencies
- 01.1 Data Models ✓
- 01.3 Card Deck Setup ✓
- 03.1 Drag Drop Mechanics (partial)
- 03.2 Animations Transitions (partial)

## Status: 🟢 Complete