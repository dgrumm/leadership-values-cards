# Feature Spec: 02.2 - Step 1 Initial Sort

## Overview
First step where users sort 40 cards into "More Important" and "Less Important" piles through card flipping and drag-and-drop.

## User Story
As a participant, I can flip cards one at a time and sort them into two piles to begin identifying my leadership values.

## Technical Requirements

### State Management
- [ ] Track current deck position (0-39)
- [ ] Maintain two pile arrays: moreImportant[], lessImportant[]
- [ ] Store flipped card in staging area before sorting
- [ ] Sync pile contents to prevent data loss

### UI Components
- [ ] Card deck (face-down, clickable) positioned bottom-center
- [ ] Staging area for flipped card (center, above deck)
- [ ] Two labeled drop zones: "More Important" (left), "Less Important" (right)
- [ ] Progress indicator showing cards remaining in deck
- [ ] Step indicator "Step 1 of 3" in top-right
- [ ] Header with "← Leave Session" and "👥X Participants"

### Card Flipping Mechanics
- [ ] Click deck → flip animation (200-300ms) → card appears in staging
- [ ] Card displays value name (large, bold) and description (smaller)
- [ ] Only one card in staging area at a time
- [ ] Deck thickness visually decreases as cards are flipped
- [ ] Subtle shadow and depth effects on cards

### Sorting Methods
- [ ] **Drag & Drop**: Drag card from staging to either pile
- [ ] **Click Pile Title**: Click "More Important" or "Less Important" labels
- [ ] Cards snap to pile when >50% overlaps drop zone
- [ ] Smooth snap animation (200ms ease-out)
- [ ] Cards stack with slight offset to show multiple cards

### Pile Management
- [ ] Cards can be moved between piles after placement
- [ ] Visual feedback when dragging over valid drop zones
- [ ] Cards maintain readable stacking (max 3 visible)
- [ ] Pile counters show number of cards

### Progression Rules
- [ ] "Step 2 ➜" button appears only when deck is empty
- [ ] Both piles must have ≥1 card to proceed
- [ ] Validation message if attempting to proceed incorrectly
- [ ] Save state before transitioning to Step 2

## Animation Specifications
- **Card flip**: 200-300ms ease-in-out with 3D rotation
- **Snap to pile**: 200ms ease-out with subtle bounce
- **Card hover**: translateY(-4px) with increased shadow
- **Pile highlight**: Border glow when drag hovering

## Layout Structure
```
[← Leave Session]  [👥5 Participants]        [Step 1 of 3] [x]

┌─────────────────────┐     ┌─────────────────────┐
│   More Important    │     │   Less Important    │
│      (12 cards)     │     │      (15 cards)     │
│   [Card stacks]     │     │   [Card stacks]     │
└─────────────────────┘     └─────────────────────┘

        ┌──────────────────┐
        │    TRUST         │  ← Flipped card (staging)
        │ Firm reliance... │
        └──────────────────┘

┌─────────────────────┐
│ Leadership Values   │
│ Cards (13 left)     │  ← Main deck (face-down)
└─────────────────────┘

                [Step 2 ➜]
```

## First-Time Modal
- [ ] Appears on first visit to Step 1
- [ ] Explains exercise rules clearly
- [ ] "Sort the leadership values into two piles"
- [ ] "Click the deck to flip cards one at a time"
- [ ] "Drag cards to sort them, or click the pile name"
- [ ] "You can move cards between piles at any time"
- [ ] Dismissible with "Got it" button

## Validation Rules
- [ ] Cannot flip next card if one is in staging
- [ ] Cannot proceed if cards remain in main deck
- [ ] Both piles must have at least one card
- [ ] Maximum 1 card in staging area at any time
- [ ] All cards must be sorted before Step 2

## Error Handling
- [ ] Show helpful message if trying to proceed with empty piles
- [ ] Prevent card flipping if staging area occupied
- [ ] Handle drag cancellation (card returns to origin)
- [ ] Graceful handling of rapid clicks on deck

## Performance Requirements
- [ ] Maintain 60fps during card animations
- [ ] Responsive drag operations (<16ms)
- [ ] Smooth pile transitions and updates
- [ ] Memory efficient card state management

## Acceptance Criteria
- [ ] All 40 cards can be flipped and sorted
- [ ] Animations complete within specified times
- [ ] "Step 2" button appears only when deck empty and piles valid
- [ ] Cards maintain 60fps performance during drag operations
- [ ] Pile contents persist across browser refresh
- [ ] Modal explains rules clearly on first visit

## Test Cases
1. Complete sort of all 40 cards successfully
2. Move cards between piles after initial placement
3. Attempt to proceed with empty deck but invalid piles
4. Test drag and click sorting methods
5. Verify animation performance under load
6. Test modal display and dismissal
7. Verify state persistence across page refresh
8. Test rapid clicking and edge cases

## Dependencies
- 01.1 Data Models ✓
- 01.3 Card Deck Setup ✓
- 03.1 Drag Drop Mechanics (partial)
- 03.2 Animations Transitions (partial)

## Status: 🔴 Not Started