# Feature Spec: 02.3 - Step 2 Top Eight

## Overview
Second step where users narrow their "More Important" cards down to exactly 8 most important values.

## User Story
As a participant, I can select my top 8 most important leadership values from my previously sorted "More Important" pile.

## Technical Requirements

### Transition Animation
- [x] Less Important pile → neaten the cards from step1 landing zone into a stack → flip face-down → move to discard area (500ms)
- [x] More Important pile → neaten the cards from step1 landing zone into a stack → flip face-down → move to main deck position (500ms)
- [x] Pile labels change: "Top 8 Most Important" and "Less Important"
- [x] Counter appears: "(0/8)" next to Top 8 pile
- [x] Step indicator updates to "Step 2 of 3"

### State Management
- [x] Transfer More Important cards to new deck
- [x] Initialize empty Top 8 and Less Important piles
- [x] Track card count in Top 8 pile (0-8)
- [x] Maintain discard pile visibility in bottom-right as actual face-down deck with descriptive counter

### Pile Constraints
- [x] **Strict Limit**: Exactly 8 cards maximum in Top 8 pile
- [x] **Real-time Counter**: "(3/8)" updates as cards added/removed
- [x] **Overflow Protection**: 9th card bounces back to staging area with animation
- [x] **Bounce Animation**: 400ms elastic bounce with warning message
- [x] **Warning Message**: "Remove a card from Top 8 to add another" (auto-dismiss 3s)

### Card Interaction
- [x] Same flip and sort mechanics as Step 1
- [x] Cards can move between Top 8 and Less Important piles
- [x] Drag validation prevents exceeding 8-card limit
- [x] Visual feedback when approaching limit (pile glow)
- [x] Click pile title for quick sorting from staging

### Review Progression
- [x] "Review Top 8 ➜" button appears when:
  - Exactly 8 cards in Top 8 pile
  - Main deck is empty
  - All cards are sorted
- [x] Button to proceed to Step 3 remains disabled until conditions met
- [x] Clear validation messaging for unmet conditions

### Edge Case: Fewer Than 8 Cards Available
- [x] **Detection**: When Step 1 "More Important" pile has < 8 cards
- [x] **Keep All Option**: "Keep All & Continue to Step 3" button appears
- [x] **Reveal Option**: "Reveal" button in header allows sharing choices with others
- [x] **Bypass Validation**: Keep All option skips 8-card requirement
- [x] **User Choice**: Participant can still manually sort if they prefer

## Layout Structure
```
[← Leave Session]  [👥5 Participants]  [Reveal]  [Step 2 of 3] [x]

┌─────────────────────┐     ┌─────────────────────┐
│  Top 8 Most Important│     │   Less Important    │
│       (3/8)         │     │     (15 cards)      │
│   [Card stacks]     │     │   [Card stacks]     │
│      28rem height   │     │      28rem height   │
└─────────────────────┘     └─────────────────────┘

┌─────────────────────┐     ┌──────────────────┐
│ Leadership Values   │     │   TEAMWORK       │  ← Flipped card (staging)
│ Cards (10 left)     │     │ Cooperative...   │
└─────────────────────┘     └──────────────────┘

                                           ┌──────────┐
                                           │Discarded │
                                           │(15 cards)│
                                           └──────────┘

                [Keep All & Continue ➜] or [Review Top 8 ➜]
```

## Game Steps Modal (Side Panel)
- [x] Automatically appears on Step 2 entry
- [x] "Select your Top 8 most important values"
- [x] Explains the reduction process
- [x] Mentions ability to move cards between piles
- [x] "You must select exactly 8 cards to continue"
- [x] Dismissible with "Got it" button
- [x] Clicking "Step 2 of 3" in header will re-display modal
- [x] User can view game progress any time by clicking the "Step x of y" button in header  
- [x] Step button shows clickable chevron icon to indicate side panel functionality
- [x] Game Steps Modal shows current state - number of cards sorted into each pile, number of cards in deck left to sort


### Overflow Behavior
- [x] **Visual Warning**: Top 8 pile border turns red when at limit
- [x] **Bounce Animation**: 9th card bounces back to origin (400ms elastic)
- [x] **Toast Message**: Warning appears near Top 8 pile
- [x] **Counter Highlight**: "(8/8)" shows in bold/colored when full
- [x] **Drag Prevention**: Visual feedback shows invalid drop zones

## Validation Rules
- [x] Exactly 8 cards required in Top 8 pile
- [x] No cards can remain in main deck
- [x] All cards must be sorted (staging area empty)
- [x] Cannot exceed 8-card limit in Top 8 pile
- [x] Must complete sorting before review

## Animation Specifications
- **Same as Step 1 spec**

## Error States
- [x] Warning when trying to exceed 8 cards
- [x] Validation message if trying to review with wrong count
- [x] Clear feedback for cards remaining in deck
- [x] Helpful hints for first-time users

## Accessibility
- [x] Screen reader announces counter changes
- [x] Clear visual feedback for pile limits
- [x] Keyboard navigation for all interactions
- [x] High contrast support for warnings

## Acceptance Criteria
- [x] Transition animation completes smoothly from Step 1
- [x] 8-card limit strictly enforced with appropriate feedback
- [x] Counter updates accurately and immediately
- [x] "Review Top 8" button only enables when conditions met
- [x] Bounce animation provides clear rejection feedback
- [x] All cards can be sorted with consistent mechanics

## Test Cases
1. Complete Step 1 and verify smooth transition to Step 2
2. Sort exactly 8 cards and verify review button appears  
3. Attempt to add 9th card and verify bounce behavior
4. Move cards between piles and verify counter updates
5. Try to proceed with wrong card count (7, 9, etc.)
6. Verify pile limit warnings and visual feedback
7. Test counter accuracy with rapid card movements
8. Verify discard pile shows as face-down deck with descriptive counter
9. **Edge Case**: Complete Step 1 with < 8 "More Important" cards
10. **Edge Case**: Verify "Keep All & Continue" option appears
11. **Reveal Feature**: Test Reveal button in header for sharing choices
12. **Layout Consistency**: Verify deck/staging positioning matches Step 1 exactly
13. **Drop Zone Consistency**: Verify 28rem height and same card scaling as Step 1

## Dependencies
- 02.2 Step 1 Initial Sort ✓
- 03.1 Drag Drop Mechanics ✓
- 03.2 Animations Transitions ✓
- 03.3 Pile Constraints ✓

## Status: 🟢 Complete + Enhanced