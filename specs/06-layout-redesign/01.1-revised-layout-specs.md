# Leadership Values Card Sort - Horizontal Layout Specifications
## Based on Physical Card Layout Photo

### 1. Core Layout Architecture

#### 1.1 Horizontal Flow Design
The application follows a **left-to-right flow** with vertical sorting distinction:

```
┌────────────────────────────────────────────────────────┐
│  [Header: Session Info | Step Progress | Participants]  │
├────────────────────────────────────────────────────────┤
│                                                         │
│                                    ┌─────────────────┐ │
│                                    │ More Important  │ │
│  ┌──────────┐   ┌──────────┐      │  (Top Right)    │ │
│  │          │   │          │      └─────────────────┘ │
│  │   Deck   │   │ Flipped  │                          │
│  │  (Left)  │   │   Card   │                          │
│  │          │   │ (Center) │      ┌─────────────────┐ │
│  └──────────┘   └──────────┘      │ Less Important  │ │
│                                    │ (Bottom Right)  │ │
│                                    └─────────────────┘ │
│                                                         │
├────────────────────────────────────────────────────────┤
│  [Footer: Progress Info | Action Buttons]               │
└────────────────────────────────────────────────────────┘
```

### 2. Precise Component Positioning

#### 2.1 Canvas Grid System
- **Total Canvas**: 1920px × 900px (optimized for 1920×1080 screens)
- **Usable Area**: 1920px × 780px (minus 120px for header/footer)
- **Grid**: 12 columns × 6 rows for precise positioning

#### 2.2 Component Coordinates & Dimensions

**Main Deck (Left Side)**
- **Position**: 
  - X: 200px from left edge
  - Y: Vertically centered (290px from top)
- **Size**: 200px × 280px
- **Visual**: Stack of face-down cards with 2px offset per card
- **Interaction**: Click to flip top card

**Staging Area (Center-Left)**
- **Position**: 
  - X: 500px from left edge (100px gap from deck)
  - Y: Vertically centered (290px from top)
- **Size**: 220px × 300px (slightly larger for emphasis)
- **Visual**: Empty space until card is flipped
- **Purpose**: Temporary holding for decision-making

**More Important Pile (Top-Right)**
- **Position**: 
  - X: 900px from left edge
  - Y: 150px from top
- **Size**: 300px × 400px
- **Border**: 2px dashed #4A90E2 (blue)
- **Background**: rgba(74, 144, 226, 0.05)
- **Label**: "More Important" above the pile

**Less Important Pile (Bottom-Right)**
- **Position**: 
  - X: 900px from left edge
  - Y: 430px from top
- **Size**: 300px × 400px
- **Border**: 2px dashed #B0B0B0 (gray)
- **Background**: rgba(176, 176, 176, 0.05)
- **Label**: "Less Important" above the pile

**Discard Area (Far Right - Hidden Initially)**
- **Position**: 
  - X: 1400px from left edge
  - Y: 500px from top
- **Size**: 140px × 200px (reduced scale)
- **Opacity**: 0.5 when visible
- **Appears**: After Step 1 completion

### 3. Interaction Flow Details

#### 3.1 Card Flip Mechanics
```
User Action: Click on Deck (left)
→ Top card slides right (translateX: 300px)
→ Card flips during movement (rotateY: 180deg)
→ Card settles in staging area
→ User makes sorting decision
```

**Animation Sequence:**
- 0-150ms: Card begins sliding right and rotating
- 150-300ms: Card completes flip and settles in staging area
- Total: 300ms for smooth, natural motion

#### 3.2 Sorting Interactions

**Primary: Drag and Drop**
- Drag from staging area to either right pile
- Visual feedback during drag:
  - Card opacity: 0.8
  - Target pile highlight on hover
  - Cursor: grabbing
- Snap behavior:
  - Threshold: 30% overlap with target
  - Animation: 200ms ease-out snap

**Secondary: Click Pile to Sort**
- Click "More Important" → Card animates to top-right
- Click "Less Important" → Card animates to bottom-right
- Animation path: Curved bezier for natural movement
- Duration: 400ms

**Tertiary: Keyboard Shortcuts**
- **Up Arrow or W**: Sort to More Important (top-right)
- **Down Arrow or S**: Sort to Less Important (bottom-right)
- **Space or Enter**: Flip next card from deck
- **Tab**: Cycle focus between interactive elements

### 4. Visual Design System

#### 4.1 Card Styling
```css
.card {
  width: 200px;
  height: 280px;
  border-radius: 12px;
  background: linear-gradient(135deg, #FFFFFF 0%, #F8F9FA 100%);
  box-shadow: 
    0 2px 4px rgba(0,0,0,0.1),
    0 8px 16px rgba(0,0,0,0.05);
  border: 1px solid #E0E0E0;
  padding: 24px;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.card-back {
  background: linear-gradient(135deg, #4A90E2 0%, #7B68EE 100%);
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 600;
}

.card.flipped {
  transform: rotateY(180deg);
}

.card.dragging {
  opacity: 0.8;
  transform: scale(1.05);
  cursor: grabbing;
}
```

#### 4.2 Pile Visual States
```css
.pile {
  border: 2px dashed #B0B0B0;
  border-radius: 16px;
  transition: all 0.2s ease;
  position: relative;
}

.pile.more-important {
  border-color: #4A90E2;
  background: rgba(74, 144, 226, 0.05);
}

.pile.active-drop-zone {
  border-color: #28A745;
  border-width: 3px;
  background: rgba(40, 167, 69, 0.08);
}

.pile.invalid-drop {
  animation: shake 0.4s;
  border-color: #DC3545;
}

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-5px); }
  75% { transform: translateX(5px); }
}
```

### 5. Step Progression Transitions

#### 5.1 Step 1 → Step 2 Animation
**Duration: 1800ms total**

1. **0-400ms**: Less Important pile condenses into neat stack
2. **400-800ms**: Less Important stack flips face-down and slides to discard area (far right)
3. **600-1000ms**: More Important pile condenses into neat stack
4. **1000-1400ms**: More Important stack flips face-down and moves to deck position
5. **1400-1800ms**: New pile labels fade in ("Top 8 Most Important", "Less Important")
6. **1800ms**: Counter "(0/8)" appears on top-right pile

#### 5.2 Step 2 → Review Animation
**Duration: 1000ms total**

1. **0-300ms**: Less Important pile slides to discard area
2. **200-700ms**: Top 8 pile frame expands to show all cards
3. **700-1000ms**: Action buttons fade in (Snapshot, Reveal, Next Step)

### 6. State Management Model

#### 6.1 Card State
```javascript
const cardState = {
  id: "trust",
  value_name: "Trust",
  description: "Firm reliance on...",
  currentZone: "deck", // deck|staging|moreImportant|lessImportant|top8|top3|discard
  position: { x: 0, y: 0 }, // Relative to zone
  stackOrder: 0, // Order within zone
  isFlipped: false,
  isDragging: false,
  animationState: "idle" // idle|flipping|moving|snapping
}
```

#### 6.2 Zone Configuration
```javascript
const zones = {
  deck: {
    position: { x: 200, y: 290 },
    capacity: Infinity,
    stackOffset: { x: 0, y: -2 },
    acceptsDrop: false,
    clickAction: "flip"
  },
  staging: {
    position: { x: 500, y: 290 },
    capacity: 1,
    stackOffset: { x: 0, y: 0 },
    acceptsDrop: false,
    clickAction: null
  },
  moreImportant: {
    position: { x: 900, y: 150 },
    capacity: Infinity, // Changes to 8 in Step 2, 3 in Step 3
    stackOffset: { x: 2, y: 2 },
    acceptsDrop: true,
    clickAction: "quickSort"
  },
  lessImportant: {
    position: { x: 900, y: 430 },
    capacity: Infinity,
    stackOffset: { x: 2, y: 2 },
    acceptsDrop: true,
    clickAction: "quickSort"
  },
  discard: {
    position: { x: 1400, y: 500 },
    capacity: Infinity,
    stackOffset: { x: 1, y: -1 },
    acceptsDrop: false,
    clickAction: null
  }
}
```

### 7. Responsive Behavior

#### 7.1 Breakpoint Adjustments
```css
/* Standard Desktop (1920×1080) - Default */
.canvas { width: 1920px; }

/* Smaller Desktop (1366×768) */
@media (max-width: 1440px) {
  .canvas { 
    transform: scale(0.85);
    transform-origin: top left;
  }
  .pile { 
    width: 260px; 
    height: 360px; 
  }
}

/* Larger Displays (2560×1440) */
@media (min-width: 2560px) {
  .canvas { 
    transform: scale(1.2);
    transform-origin: top center;
  }
}
```

### 8. Step-Specific Behaviors

#### 8.1 Step 1: Initial Sort (All Cards)
- **Deck**: 40 cards (or per CSV)
- **Staging**: One card at a time
- **Piles**: Unlimited capacity
- **Progress**: "Step 1 of 3"
- **Completion**: When deck is empty

#### 8.2 Step 2: Reduce to Top 8
- **Deck**: "More Important" cards from Step 1
- **Top-Right Pile**: Renamed to "Top 8 Most Important" with (X/8) counter
- **Bottom-Right Pile**: "Less Important"
- **Constraint**: Maximum 8 cards in top-right pile
- **Overflow**: 9th card bounces back with error message

#### 8.3 Step 3: Final Top 3
- **Deck**: Top 8 cards from Step 2
- **Top-Right Pile**: "Top 3 Most Important" with (X/3) counter
- **Constraint**: Exactly 3 cards maximum
- **Completion**: Triggers final review screen

### 9. Accessibility Features

#### 9.1 Keyboard Navigation
- **Tab Order**: Deck → Staging → More Important → Less Important → Action Buttons
- **Focus Indicators**: 3px solid outline with 2px offset
- **Skip Links**: Hidden shortcuts to jump to main areas

#### 9.2 Screen Reader Support
```html
<div role="region" aria-label="Card sorting workspace">
  <button aria-label="Deck with 40 cards. Click to flip next card">
  <div aria-live="polite" aria-label="Staging area">
  <div role="region" aria-label="More Important pile, 5 cards">
</div>
```

### 10. Performance Optimizations

#### 10.1 Animation Performance
- Use CSS transforms only (GPU-accelerated)
- Apply `will-change` property during animations
- Remove `will-change` after animation completes
- Batch DOM updates using requestAnimationFrame

#### 10.2 Memory Management
- Maximum 100 cards in memory at once
- Lazy-load card descriptions
- Clear animation timers on component unmount
- Debounce real-time sync to 60fps

### 11. Error Handling

#### 11.1 Pile Overflow
```javascript
function handlePileOverflow(pile, card) {
  if (pile.cards.length >= pile.maxCapacity) {
    // Bounce animation
    card.animate([
      { transform: 'translateY(0)' },
      { transform: 'translateY(-20px)' },
      { transform: 'translateY(0)' }
    ], {
      duration: 400,
      easing: 'cubic-bezier(0.68, -0.55, 0.265, 1.55)'
    });
    
    // Show message
    showNotification(`Remove a card from ${pile.name} first`, 'warning');
    return false;
  }
  return true;
}
```

### 12. Testing Checklist

- [ ] Cards flip smoothly from deck to staging (300ms)
- [ ] Drag and drop works to both piles
- [ ] Click-to-sort provides proper feedback
- [ ] Keyboard shortcuts function correctly
- [ ] Pile constraints are enforced (8 and 3 limits)
- [ ] Step transitions are smooth and clear
- [ ] Card counters update in real-time
- [ ] Works at 1366×768 minimum resolution
- [ ] All animations run at 60fps
- [ ] Accessibility features work properly

---

## 📋 COMPREHENSIVE IMPACT ANALYSIS (v2.0 Implementation)

> **Analysis Date**: 2025-08-26  
> **Current Status**: Deferred to v2.0 - MVP uses current vertical layout  
> **Priority**: Medium - Enhancement for future release

### 🔍 Key Finding: Partial Implementation Exists

The staging area and flip mechanics **already exist** in the current implementation, but the overall layout architecture requires major restructuring from vertical to horizontal layout.

---

## ⚠️ SPECIFICATION UPDATES REQUIRED

### Foundation Specs (01.x) - Minor Updates ✅
**01.1 Data Models**: Already supports new requirements  
- Card interface has `position: { x, y }` ✅  
- CardPile includes `staging` and `discard` ✅  
- Zone system can be extended ✅

### Core Flow Specs (02.x) - Major Rewrites ❌
**02.2 Step 1**: Layout diagrams completely wrong
- **Current**: Vertical (piles top, deck+staging bottom)  
- **Required**: Horizontal (deck left, staging center, piles right)  
- **Action**: Rewrite entire layout section with new coordinates

**02.3 Step 2**: Step transition animations incompatible  
- **Current**: Simple pile transitions
- **Required**: Complex 1800ms 5-stage sequence with discard area
- **Action**: Complete animation spec rewrite

**02.4 Step 3**: Same functionality, different positioning

### Interaction Specs (03.x) - Major Overhauls ❌
**03.1 Drag Drop**: Interaction patterns mismatch
- **Missing**: Click-pile sorting, keyboard shortcuts (Up/Down/W/S/Space)
- **Action**: Add multi-modal interaction spec

**03.2 Animations**: Timing and sequencing differences
- **Current**: Basic card movements  
- **Required**: 300ms flip sequence, curved bezier paths, GPU optimization
- **Action**: New animation system specification  

**03.3 Pile Constraints**: Enhanced error handling needed
- **Required**: Bounce animation with cubic-bezier + notifications

---

## 🧪 E2E TESTS IMPACT: Minimal Breakage 🟡

### Tests That Will SURVIVE ✅
Current E2E tests are **selector-based** and will likely continue working because:
- `[data-testid="deck"]` - ✅ Still exists  
- `[data-testid="staging-area"]` - ✅ Already implemented
- `[data-testid="more-important-pile"]` - ✅ Still exists
- `[data-testid="less-important-pile"]` - ✅ Still exists

### Tests Requiring Updates ⚠️
- **Visual regression tests**: Screenshots will differ due to layout change
- **Animation timing tests**: May need adjustment for new 300ms flip timing  
- **Position-based assertions**: Any tests checking element positions

**IMPACT RATING**: 🟡 **MODERATE** - Most test logic survives, mainly visual updates needed

---

## 🏗️ COMPONENT ARCHITECTURE CHANGES

### Already Implemented ✅
- **StagingArea.tsx**: Complete with 3D flip animations
- **Card flip mechanics**: Deck → staging flow working
- **Drag from staging**: Already implemented  
- **Auto-flip**: Next card automatically flips when previous is placed

### Major Changes Required ❌

**Step1Page.tsx** - Complete layout restructure:
```typescript
// CURRENT - Flexible vertical layout
<div className="grid grid-cols-2 gap-8 mb-8">
  <DroppableZone id="more-important" />  // Top-left
  <DroppableZone id="less-important" />  // Top-right
</div>
<div className="flex items-center justify-center gap-8">
  <Deck />      // Bottom-left
  <StagingArea />  // Bottom-right
</div>

// REQUIRED - Fixed horizontal layout  
<div className="absolute" style={{width: '1920px', height: '900px'}}>
  <div style={{position: 'absolute', left: '200px', top: '290px'}}>   // Deck left
  <div style={{position: 'absolute', left: '500px', top: '290px'}}>   // Staging center
  <div style={{position: 'absolute', left: '900px', top: '150px'}}>   // More Important top-right
  <div style={{position: 'absolute', left: '900px', top: '430px'}}>   // Less Important bottom-right
  <div style={{position: 'absolute', left: '1400px', top: '500px'}}> // Discard far-right
</div>
```

### New Components Needed
- **CanvasLayout**: Fixed 1920×900px container with absolute positioning
- **ResponsiveWrapper**: Scale transforms for different screen sizes  
- **Enhanced DroppableZone**: Support for fixed positioning and new visual states
- **KeyboardShortcuts**: Handler for Up/Down/W/S/Space key interactions

---

## 📊 MIGRATION PLAN & RISK ASSESSMENT

### 🚀 Implementation Strategy

**Phase 1: Specification Alignment** ⏱️ 1-2 days
1. Update specs 02.2, 02.3, 03.1, 03.2, 03.3 with revised layout
2. Create new acceptance criteria aligned with horizontal layout
3. Update all layout diagrams and mockups

**Phase 2: Component Migration** ⏱️ 3-5 days  
1. Create `CanvasLayout` wrapper with fixed positioning
2. Migrate `Step1Page.tsx` from grid to absolute positioning
3. Add keyboard shortcuts and click-pile interactions
4. Implement responsive scaling system

**Phase 3: Animation Enhancements** ⏱️ 2-3 days
1. Update flip timing to spec (300ms sequence)
2. Add curved bezier path animations  
3. Implement enhanced pile overflow bounces
4. GPU optimization with `will-change` properties

**Phase 4: Test Updates** ⏱️ 1-2 days
1. Update visual regression baselines
2. Verify animation timing tests  
3. Test responsive scaling on multiple screen sizes

### ⚡ Risk Assessment

**🟢 LOW RISK AREAS**
- **Data models**: Already compatible
- **Core E2E functionality**: Selector-based tests should survive  
- **Staging mechanics**: Already implemented and working

**🟡 MEDIUM RISK AREAS** 
- **Animation performance**: Fixed positioning may impact performance on slower devices
- **Responsive behavior**: CSS transforms could cause issues on edge screen sizes
- **Browser compatibility**: Heavy CSS transforms may not work on older browsers

**🔴 HIGH RISK AREAS**
- **Layout breaking changes**: Complete UI restructure during active development  
- **User experience**: Horizontal vs vertical layout is a significant UX change
- **Screen size constraints**: 1920px minimum width excludes many users

---

## 🎯 IMPLEMENTATION RECOMMENDATION

### Option A: Full Migration 
**Effort**: 7-12 days, **Risk**: High, **Reward**: Complete spec alignment

### Option B: Hybrid Approach ⭐ **RECOMMENDED FOR v2.0**
**Effort**: 3-5 days, **Risk**: Medium, **Reward**: Core benefits with less disruption

**Hybrid Implementation:**
1. Keep current **flexible layout** for responsiveness  
2. Add **keyboard shortcuts** and **click-pile interactions**
3. Enhance **animation timing** (300ms flip sequence)
4. Implement **enhanced error handling** with bounces
5. **Skip** fixed pixel positioning and precise coordinates

### Option C: Full Fixed Layout (Original Spec)
**Effort**: 7-12 days, **Risk**: High, **Reward**: Exact spec compliance but loses responsive design

---

## 📝 DECISION RATIONALE

**Why Deferred to v2.0:**
- Current MVP is 95% complete with working E2E tests
- Layout changes would require significant regression testing  
- Collaboration features (Phase 3) provide more user value than layout changes
- Risk of introducing bugs in an otherwise stable system

**v2.0 Implementation Notes:**
- Prioritize keyboard shortcuts and enhanced animations over fixed positioning
- Maintain responsive design principles while incorporating spec improvements
- Consider user feedback from v1.0 before committing to horizontal layout

This spec serves as the foundation for v2.0 layout enhancements while preserving the working MVP in v1.0.

## Status: 🔴 Not Started