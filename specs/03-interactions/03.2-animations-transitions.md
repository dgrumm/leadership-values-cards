# Feature Spec: 03.2 - Animations & Transitions

## Overview
Comprehensive animation system for card flips, pile transitions, step changes, and UI feedback throughout the exercise.

## User Story
As a participant, I experience smooth, delightful animations that provide clear feedback and enhance the card sorting experience.

## Technical Requirements

### Card Flip Animations
- [ ] **Flip Trigger**: Click on deck initiates card flip
- [ ] **3D Rotation**: Y-axis rotation from 0Â° to 180Â° and back
- [ ] **Timing**: 200-300ms ease-in-out for complete flip
- [ ] **Content Change**: Switch from card back to front at 90Â°
- [ ] **Staging Movement**: Simultaneous move to staging position

### Pile Transition Animations
- [ ] **Step 1 â†’ Step 2**: Smooth pile reorganization (500ms)
  - Less Important â†’ neat stack â†’ flip â†’ move to discard
  - More Important â†’ neat stack â†’ flip â†’ move to deck position
- [ ] **Step 2 â†’ Review**: Frame expansion animation (500ms)
- [ ] **Review â†’ Step 3**: Cards collect and redistribute
- [ ] **Discard Movement**: Smooth relocation to bottom-right

### Movement Animations
- [ ] **Snap to Pile**: 200ms ease-out with subtle overshoot
- [ ] **Bounce Rejection**: 400ms elastic animation for overflow
- [ ] **Card Hover**: translateY(-4px) with increased shadow
- [ ] **Pile Rearrangement**: Smooth redistribution when cards added/removed

## Animation Timing System
```javascript
const ANIMATION_TIMINGS = {
  // Card interactions
  cardFlip: 250,           // 200-300ms range
  cardSnap: 200,           // Snap to pile
  cardHover: 150,          // Hover state change
  cardBounce: 400,         // Rejection bounce
  
  // Pile transitions
  pileTransition: 500,     // Step transitions
  frameExpansion: 500,     // Review frame growth
  deckShuffle: 1500,       // Post-login shuffle
  
  // UI feedback
  fadeIn: 200,             // Modal/button appearances
  fadeOut: 200,            // Dismissals
  buttonPress: 100,        // Button feedback
  notification: 300,       // Toast messages
};
```

### Step Transition Choreography
- [ ] **Step 1 â†’ Step 2 Sequence**:
  1. Fade out "Step 2" button (200ms)
  2. Less Important pile stacks (300ms)
  3. Pile flips face-down (200ms)
  4. Move to discard area (500ms)
  5. More Important pile stacks (300ms)
  6. Pile flips and moves to deck (500ms)
  7. Labels update with fade transition (200ms)
  8. New step UI fades in (200ms)

### Frame Expansion Animation
- [ ] **Review State Transition**:
  1. Less Important pile moves to discard (300ms)
  2. Top 8 pile frame begins expansion (100ms delay)
  3. Frame grows to 80% canvas width (500ms ease-out)
  4. Cards redistribute within frame (300ms stagger)
  5. Action buttons fade in (200ms)

### Microinteractions
- [ ] **Button Hover**: Scale(1.02) with shadow increase (100ms)
- [ ] **Card Selection**: Subtle glow effect on important cards
- [ ] **Counter Updates**: Number changes with bounce effect
- [ ] **Progress Bar**: Smooth width transitions for step progress
- [ ] **Tooltip Appearances**: 200ms fade with slight upward movement

## Framer Motion Integration
```javascript
// Card flip animation variants
const cardFlipVariants = {
  front: { 
    rotateY: 0,
    transition: { duration: 0.25, ease: "easeInOut" }
  },
  back: { 
    rotateY: 180,
    transition: { duration: 0.25, ease: "easeInOut" }
  }
};

// Pile transition variants
const pileTransitionVariants = {
  collecting: {
    scale: 0.8,
    y: -20,
    transition: { duration: 0.3 }
  },
  moving: {
    x: [0, -100, -200],
    y: [0, 50, 100],
    transition: { duration: 0.5, ease: "easeOut" }
  }
};

// Frame expansion variants
const frameExpansionVariants = {
  collapsed: {
    width: "300px",
    height: "400px"
  },
  expanded: {
    width: "80%",
    height: "70%",
    transition: { 
      duration: 0.5, 
      ease: "easeOut",
      delayChildren: 0.2,
      staggerChildren: 0.1
    }
  }
};
```

### Performance Optimization
- [ ] **Hardware Acceleration**: Use transform3d for GPU acceleration
- [ ] **Will-Change Property**: Optimize for upcoming animations
- [ ] **Animation Batching**: Group related animations together
- [ ] **RequestAnimationFrame**: Sync with browser refresh rate
- [ ] **Reduced Motion Support**: Respect prefers-reduced-motion setting

### Accessibility Considerations
- [ ] **Motion Preferences**: Reduce/disable animations for sensitive users
- [ ] **Focus Management**: Maintain focus during animations
- [ ] **Screen Reader**: Announce state changes, not animation details
- [ ] **High Contrast**: Ensure animations work in high contrast mode
- [ ] **Timing**: Allow sufficient time for users to process changes

## Loading & Shuffle Animations
- [ ] **Initial Deck Shuffle**: 1-2 second spinning animation after login
- [ ] **Card Dealing**: Staggered appearance of cards (50ms intervals)
- [ ] **Progress Indicators**: Smooth loading bars and spinners
- [ ] **Skeleton Screens**: Animated placeholders during data loading

### Error State Animations
- [ ] **Shake Animation**: Input fields on validation errors
- [ ] **Pulse Effect**: Buttons that require attention
- [ ] **Cross-fade**: Error message appearances
- [ ] **Slide-in Warnings**: Pile limit notifications

## Animation Debugging
- [ ] **Dev Mode Toggle**: Enable/disable animations for debugging
- [ ] **Slow Motion Mode**: 0.25x speed for development
- [ ] **Animation Boundaries**: Visual guides for animation extents
- [ ] **Performance Monitoring**: Track animation frame rates

### Stagger Patterns
```javascript
// Card distribution staggering
const staggeredDistribution = {
  animate: "visible",
  variants: {
    visible: {
      transition: {
        staggerChildren: 0.1,
        delayChildren: 0.2
      }
    }
  }
};

// Button group animations
const buttonGroupStagger = {
  visible: {
    transition: {
      staggerChildren: 0.05,
      when: "beforeChildren"
    }
  }
};
```

## Acceptance Criteria
- [ ] All animations complete within specified timings
- [ ] 60fps performance maintained during complex transitions
- [ ] Animations enhance rather than hinder usability
- [ ] Reduced motion preferences respected
- [ ] Smooth transitions between all steps
- [ ] Error states animated appropriately
- [ ] Loading states provide clear feedback

## Test Cases
1. Verify card flip timing and smoothness across browsers
2. Test step transition choreography for proper sequencing
3. Validate frame expansion animation with different card counts
4. Test bounce rejection animation with various pile states
5. Verify performance with 40 cards and multiple animations
6. Test reduced motion preference handling
7. Validate animation cleanup on component unmount
8. Test animation interruption and recovery
9. Verify stagger timing with different card counts
10. Test animation accessibility with screen readers

## Dependencies
- 03.1 Drag Drop Mechanics âœ“
- 03.3 Pile Constraints (partial)
- Framer Motion library
- CSS transforms support

## Status: ðŸŸ¡ Partial Implementation