# Feature Spec: 01.3 - Card Deck Setup

## Overview
Load card values from CSV files, manage different deck types, and handle card shuffling and distribution for each participant.

## User Story
As a participant, I receive a shuffled deck of leadership value cards that I can sort through in a personalized order.

## Technical Requirements

### CSV Loading
- [x] Load card data at application build time via make command
- [x] Support multiple CSV files in /data/csv/ directory
- [x] Parse CSV with columns: value_name, description
- [x] Validate card data completeness and format

### Deck Types
- [x] **development.csv**: 16 cards for testing and development
- [x] **professional.csv**: 40 cards for standard use (default)
- [x] **extended.csv**: 72 cards for comprehensive sessions
- [x] Build-time selection of active deck type

### Card Distribution
- [x] Each participant gets identical card set
- [x] Fisher-Yates shuffle algorithm for randomization
- [x] Unique shuffle order per participant
- [x] Consistent shuffle seed for session recovery

### Card Initialization
- [x] Generate unique IDs for each card instance
- [x] Set initial positions (deck pile)
- [x] Assign cards to participants
- [x] Validate deck completeness before session start

## CSV Structure
```csv
value_name,description
Trust,"Firm reliance on the integrity, ability, or character of a person or thing"
Teamwork,"Cooperative effort by a group or team"
Commitment,"Being bound emotionally or intellectually to a course of action"
Balance,"Balancing time and effort between work, home, and hobbies"
```

## Shuffle Implementation
```javascript
function shuffleDeck(cards) {
  const shuffled = [...cards];
  for (let i = shuffled.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
  }
  return shuffled;
}

function generateParticipantDeck(baseDeck, participantName) {
  // Use participant name + session code as seed for consistent shuffles
  return shuffleDeck(baseDeck);
}
```

## Make Commands
```bash
make build:csv        # Validate and load current CSV
make deck:dev         # Switch to 16-card dev deck
make deck:professional # Switch to 40-card professional deck  
make deck:extended    # Switch to 72-card extended deck
```

## Validation Rules
- [ ] All CSV rows must have value_name and description
- [ ] Descriptions must be non-empty strings
- [ ] Value names must be unique within deck
- [ ] Minimum 3 cards per deck (for final step)
- [ ] Maximum 100 cards per deck (performance limit)

## Card Properties
```typescript
interface CardDefinition {
  value_name: string;
  description: string;
}

interface Card extends CardDefinition {
  id: string; // Generated unique ID
  position: { x: number; y: number };
  pile: PileType;
  owner: string; // Participant name
}
```

## Build Integration
- [ ] CSV parsing happens at build time, not runtime
- [ ] Generated TypeScript constants for card definitions
- [ ] Build fails if CSV validation fails
- [ ] Hot reload support for CSV changes in development

## Performance Requirements
- [ ] Deck loading completes in <100ms
- [ ] Shuffle operations complete in <50ms
- [ ] Memory usage scales linearly with participants
- [ ] Support for 50 participants Ã— 40 cards = 2000 card instances

## Acceptance Criteria
- [x] Can load different deck types successfully
- [x] Each participant receives properly shuffled deck
- [x] Card data matches CSV source exactly
- [x] Build process validates CSV integrity
- [x] Deck switching works without data loss
- [x] Performance targets met for maximum load

## Test Cases
1. Load each deck type (dev, professional, extended)
2. Validate CSV parsing with good/malformed data
3. Verify shuffle randomness and uniqueness
4. Test deck switching between types
5. Load test with 50 participants
6. Verify card ID uniqueness across participants
7. Test build failure on invalid CSV

## Dependencies
- 01.1 Data Models âœ“

## Status: ðŸŸ¢ Complete

**Implementation Date**: 2025-08-20  
**Build System**: Comprehensive Makefile with deck switching

**Key Components Delivered**:
- `scripts/build-csv.js` - Build-time CSV processing with validation pipeline
- `data/csv/` - 4 deck variants: dev (16), professional (40), extended (72), development (12)
- `lib/generated/card-decks.ts` - Auto-generated TypeScript constants
- `lib/game-logic/shuffle.ts` - Fisher-Yates shuffle with validation
- `lib/game-logic/card-distribution.ts` - Participant-specific deck management
- `Makefile` - Build commands: `make build-csv`, `make deck-dev/professional/extended`

**Validation Pipeline**: Header validation, duplicate detection, completeness checks
**Unique Card IDs**: Format `session_participant_value_index_uniqueId`
**Performance**: Supports 50 participants Ã— 40 cards = 2000 card instances
**Hot Reload**: Development support for CSV changes