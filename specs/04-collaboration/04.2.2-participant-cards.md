# Feature Spec: 04.2.2 - Participant Cards

## Overview
Visual design and layout system for participant representation cards that reuse existing deck styling to show participants as stacked cards with their identity and status.

## User Story
As a participant, I can see each other participant represented as a familiar stack of cards showing their name, emoji, and current status in an organized grid layout.

## Technical Requirements

### Card Stack Visual Design
- [ ] **Base Styling**: Inherit from existing `Deck.tsx` component styling
- [ ] **Dimensions**: Use same `w-64 h-40` as values cards for consistency
- [ ] **Stack Effect**: 3-card stack using same algorithm as `Deck.tsx`
- [ ] **Color System**: Use existing `bg-gradient-to-br from-blue-600 to-purple-700`
- [ ] **Styling Inheritance**: Automatic updates when core card styling changes

### Grid Layout System
- [ ] **Responsive Grid**: 1 column (mobile), 2-3 columns (tablet/desktop)
- [ ] **Grid Spacing**: Consistent gap between participant cards
- [ ] **Center Alignment**: Cards centered within available space
- [ ] **Overflow Handling**: Scroll behavior when many participants
- [ ] **Empty State**: Handle single participant gracefully

### Participant Identity Display
- [ ] **Emoji**: Large emoji (text-3xl) at top of card
- [ ] **Name**: Prominent name display (text-lg font-semibold)
- [ ] **Color Coding**: Each participant gets unique color assignment
- [ ] **Typography**: Consistent with existing card text styling
- [ ] **Contrast**: White text on blue gradient background

### Status Display States
- [ ] **Sorting State**: "Still sorting..." with subtle dot animation
- [ ] **Button States**: "See [Name]'s Top 8/3" buttons when revealed
- [ ] **Loading State**: Skeleton or spinner during status updates
- [ ] **Offline State**: Grayed out appearance for disconnected participants
- [ ] **Status Priority**: Top 3 buttons take precedence over Top 8

## Implementation Details

### Shared Style System
```typescript
// lib/styles/card-styles.ts - Shared utilities
export const CARD_BASE_STYLES = cn(
  "w-64 h-40 rounded-xl transition-all duration-200"
);

export const CARD_DECK_STYLES = cn(
  "bg-gradient-to-br from-blue-600 to-purple-700",
  "border border-blue-500 shadow-lg"
);

export const CARD_HOVER_STYLES = cn(
  "hover:shadow-xl hover:-translate-y-1"
);

export const CARD_STACK_TRANSFORM = (index: number) => ({
  transform: `translate(${index * 1.5}px, ${index * -1.5}px)`,
  zIndex: 10 - index
});
```

### Participant Card Component
```typescript
// components/collaboration/ParticipantCard.tsx
interface ParticipantCardProps {
  participant: ParticipantOverviewData;
  onViewTop8?: () => void;
  onViewTop3?: () => void;
  isLoading?: boolean;
}

function ParticipantCard({ 
  participant, 
  onViewTop8, 
  onViewTop3, 
  isLoading = false 
}) {
  const stackCards = 3;
  const canViewTop8 = participant.revealed.top8 && participant.currentStep >= 2;
  const canViewTop3 = participant.revealed.top3 && participant.currentStep >= 3;
  
  const renderStatusContent = () => {
    if (canViewTop3) {
      return (
        <button 
          className="view-btn primary"
          onClick={onViewTop3}
        >
          See {participant.name}'s Top 3
        </button>
      );
    }
    
    if (canViewTop8) {
      return (
        <button 
          className="view-btn secondary"
          onClick={onViewTop8}
        >
          See {participant.name}'s Top 8
        </button>
      );
    }
    
    return (
      <div className="status-text">
        Still sorting...
        <SortingAnimation />
      </div>
    );
  };
  
  return (
    <div className="participant-card-container relative">
      {/* Stack effect - replicating Deck.tsx approach */}
      {Array.from({ length: stackCards }, (_, i) => (
        <motion.div
          key={i}
          className={cn(
            CARD_BASE_STYLES,
            CARD_DECK_STYLES,
            "absolute"
          )}
          style={CARD_STACK_TRANSFORM(i)}
          initial={{ scale: 0.98 + (i * 0.005) }}
          animate={{ scale: 0.98 + (i * 0.005) }}
        />
      ))}
      
      {/* Top card with participant info */}
      <motion.div
        className={cn(
          CARD_BASE_STYLES,
          CARD_DECK_STYLES,
          CARD_HOVER_STYLES,
          "relative cursor-pointer select-none",
          "flex flex-col items-center justify-center text-white",
          "focus:outline-none focus:ring-4 focus:ring-blue-300",
          isLoading && "opacity-75"
        )}
        style={{ zIndex: stackCards + 1 }}
        whileHover={{ 
          y: -4, 
          boxShadow: "0 20px 25px -5px rgba(0, 0, 0, 0.2)"
        }}
        whileTap={{ scale: 0.98 }}
      >
        <div className="participant-content flex flex-col items-center">
          <div className="participant-emoji text-3xl mb-2">
            {participant.emoji}
          </div>
          <div className="participant-name text-lg font-semibold mb-3">
            {participant.name}
          </div>
          <div className="participant-status">
            {renderStatusContent()}
          </div>
        </div>
        
        {isLoading && (
          <div className="absolute inset-0 flex items-center justify-center bg-black bg-opacity-20">
            <Spinner className="text-white" />
          </div>
        )}
      </motion.div>
    </div>
  );
}
```

### Grid Layout Component
```typescript
// components/collaboration/ParticipantsGrid.tsx
interface ParticipantsGridProps {
  participants: ParticipantOverviewData[];
  currentUserId: string;
  onViewParticipant: (participantId: string, type: 'top8' | 'top3') => void;
  isLoading?: boolean;
}

function ParticipantsGrid({ 
  participants, 
  currentUserId, 
  onViewParticipant,
  isLoading = false
}) {
  const otherParticipants = participants.filter(p => p.id !== currentUserId);
  
  if (otherParticipants.length === 0) {
    return (
      <div className="participants-grid-empty">
        <div className="empty-state text-center text-gray-500">
          <div className="text-4xl mb-4">ðŸ‘‹</div>
          <div className="text-lg font-medium mb-2">You're flying solo!</div>
          <div className="text-sm">Other participants will appear here when they join.</div>
        </div>
      </div>
    );
  }
  
  return (
    <div className={cn(
      "participants-grid",
      "grid gap-8 p-8",
      "grid-cols-1 sm:grid-cols-2 lg:grid-cols-3",
      "place-items-center",
      "max-w-7xl mx-auto"
    )}>
      {otherParticipants.map(participant => (
        <ParticipantCard
          key={participant.id}
          participant={participant}
          onViewTop8={() => onViewParticipant(participant.id, 'top8')}
          onViewTop3={() => onViewParticipant(participant.id, 'top3')}
          isLoading={isLoading}
        />
      ))}
    </div>
  );
}
```

### Sorting Animation Component
```typescript
// components/collaboration/SortingAnimation.tsx
function SortingAnimation() {
  return (
    <div className="sorting-animation flex items-center gap-1 mt-2">
      <motion.div
        className="w-1.5 h-1.5 bg-white rounded-full"
        animate={{
          scale: [1, 1.2, 1],
          opacity: [0.7, 1, 0.7]
        }}
        transition={{
          duration: 1.4,
          repeat: Infinity,
          delay: 0
        }}
      />
      <motion.div
        className="w-1.5 h-1.5 bg-white rounded-full"
        animate={{
          scale: [1, 1.2, 1],
          opacity: [0.7, 1, 0.7]
        }}
        transition={{
          duration: 1.4,
          repeat: Infinity,
          delay: 0.2
        }}
      />
      <motion.div
        className="w-1.5 h-1.5 bg-white rounded-full"
        animate={{
          scale: [1, 1.2, 1],
          opacity: [0.7, 1, 0.7]
        }}
        transition={{
          duration: 1.4,
          repeat: Infinity,
          delay: 0.4
        }}
      />
    </div>
  );
}
```

### View Button Styling
```css
/* Button styles for view actions */
.view-btn {
  @apply px-4 py-2 rounded-lg font-medium text-sm;
  @apply transition-all duration-200 cursor-pointer;
  @apply focus:outline-none focus:ring-2 focus:ring-white focus:ring-opacity-50;
}

.view-btn.primary {
  @apply bg-white text-blue-700 hover:bg-blue-50;
  @apply shadow-md hover:shadow-lg;
}

.view-btn.secondary {
  @apply bg-blue-800 text-white border border-blue-400;
  @apply hover:bg-blue-700 hover:border-blue-300;
}

.status-text {
  @apply text-white text-center opacity-75;
  @apply flex flex-col items-center;
}
```

### Responsive Design
- [ ] **Mobile (< 640px)**: Single column, full width cards
- [ ] **Tablet (640px - 1024px)**: 2 column grid
- [ ] **Desktop (> 1024px)**: 3 column grid, max width container
- [ ] **Large Screens**: Center grid, don't stretch beyond max width
- [ ] **Touch Targets**: Minimum 44px touch targets on mobile

### Loading States
- [ ] **Individual Cards**: Skeleton loading for each participant card
- [ ] **Grid Loading**: Show placeholder cards during initial load
- [ ] **Status Updates**: Subtle loading indicator when status changes
- [ ] **Progressive Loading**: Show participants as data becomes available

## Performance Optimization
- [ ] **Efficient Rendering**: Use React.memo for participant cards
- [ ] **Virtual Scrolling**: For large numbers of participants (50+)
- [ ] **Animation Performance**: Use transform properties for smooth animations
- [ ] **Memory Management**: Clean up animation timers on unmount

### Error Handling
- [ ] **Missing Data**: Graceful handling of incomplete participant data
- [ ] **Image Loading**: Fallback for missing emoji or avatar
- [ ] **Status Errors**: Default to "sorting" state for unknown status
- [ ] **Layout Errors**: Prevent layout breaks with malformed data

## Accessibility Features
- [ ] **Card Labels**: Proper ARIA labels for each participant card
- [ ] **Status Announcements**: Screen reader updates for status changes
- [ ] **Keyboard Navigation**: Tab through cards and buttons
- [ ] **High Contrast**: Ensure visibility in accessibility modes
- [ ] **Focus Indicators**: Clear focus states for all interactive elements

### Mobile Considerations
- [ ] **Touch Interactions**: Full touch support for all card interactions
- [ ] **Swipe Gestures**: Optional swipe navigation between cards
- [ ] **Viewport Optimization**: Efficient rendering on mobile devices
- [ ] **Battery Efficiency**: Optimized animations for mobile performance

## Acceptance Criteria
- [ ] Participant cards display with correct stacked card visual design
- [ ] Grid layout is responsive and centers properly at all screen sizes
- [ ] Each participant shows emoji, name, and appropriate status
- [ ] Status correctly displays "sorting" vs view buttons based on reveal state
- [ ] Visual styling matches existing card/deck design system
- [ ] Loading states provide appropriate feedback
- [ ] Empty state displays when no other participants
- [ ] Performance remains smooth with maximum participants (50)
- [ ] Mobile experience works with touch interactions
- [ ] Accessibility features work with screen readers

## Test Cases
1. **Visual Design**: Verify cards match existing deck styling
2. **Grid Layout**: Test responsive behavior across screen sizes
3. **Status Display**: Verify correct status based on participant state
4. **Empty State**: Test display when user is alone in session
5. **Loading States**: Test skeleton loading and status updates
6. **Performance**: Load test with 50 participant cards
7. **Mobile Experience**: Touch interactions and responsive design
8. **Accessibility**: Screen reader navigation and announcements

## Dependencies
- 04.2.1 Header Integration (navigation source)
- Existing Card/Deck component styling
- Framer Motion animation library
- ParticipantOverviewData type definitions

## Integration Points
- **Previous Sub-spec**: 04.2.1 Header Integration (receives navigation)
- **Next Sub-spec**: 04.2.3 Real-time Sync (provides data)
- **Styling System**: Shared card utilities from existing components
- **Animation System**: Framer Motion integration

## Status: ðŸ”´ Not Started

**Implementation Priority**: High - Core visual experience  
**Estimated Complexity**: Medium - UI-focused with shared styling  
**Design Dependencies**: Card styling system, grid layout patterns