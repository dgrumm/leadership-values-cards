# Feature Spec: 04.4 - Viewer Mode

## Overview
Read-only viewing experience for participants to see others' revealed card arrangements with live updates and viewer presence.

## User Story
As a participant, I can view others' revealed card selections in a dedicated full-screen mode with real-time updates and awareness of other viewers.

## Technical Requirements

### View Mode Interface
- [ ] **Full-screen Layout**: Dedicated view taking entire canvas area
- [ ] **Header Display**: "[Name]'s Top [8/3] Leadership Values"
- [ ] **Back Navigation**: "‚Üê Back to Participants" button
- [ ] **Viewer Avatars**: Small participant indicators in corner
- [ ] **Read-only State**: All interaction disabled except viewing

### Entry Points
- [ ] **Participant List**: "See [Name]'s Top 8/3" buttons
- [ ] **Direct Links**: URL-based access to specific reveals
- [ ] **Notification Clicks**: Click on "X revealed their cards" notifications
- [ ] **Quick Switch**: Navigate between different participants' reveals

### Layout Structure
```
[‚Üê Back to Participants]                    [üë§üë§üë§ +2 viewers]

                    Sarah's Top 8 Leadership Values

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                                                                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                    ‚îÇ
‚îÇ  ‚îÇ  TRUST  ‚îÇ  ‚îÇTEAMWORK ‚îÇ  ‚îÇBALANCE  ‚îÇ  ‚îÇINTEGRITY‚îÇ                    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                    ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                    ‚îÇ
‚îÇ  ‚îÇCOMMITMENT‚îÇ ‚îÇHONESTY  ‚îÇ  ‚îÇ GROWTH  ‚îÇ  ‚îÇRESPECT  ‚îÇ                    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                    ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Real-time Updates
- [ ] **Live Sync**: See card movements as owner makes them
- [ ] **Smooth Transitions**: Cards animate to new positions for viewers
- [ ] **Update Indicators**: Highlight recently moved cards (subtle glow)
- [ ] **Activity Status**: Show when owner is actively rearranging
- [ ] **Cursor Display**: Show owner's cursor position to viewers

### Viewer Management
- [ ] **Join Notifications**: Announce when viewers enter/leave
- [ ] **Presence Tracking**: Track all active viewers per reveal
- [ ] **Avatar Display**: Show up to 5 viewer avatars with overflow indicator
- [ ] **Hover Details**: Display viewer names on avatar hover
- [ ] **Auto-cleanup**: Remove viewer data on disconnect

## Viewer State Management
```javascript
class ViewerMode {
  constructor(ablyService, sessionCode) {
    this.channel = ablyService.getChannel(sessionCode, 'viewers');
    this.currentView = null;
    this.otherViewers = new Set();
    this.setupViewerListeners();
  }
  
  async enterView(participantId) {
    this.currentView = {
      participantId,
      startTime: Date.now(),
      isActive: true
    };
    
    // Notify others that we're viewing
    await this.channel.publish('viewer-joined', {
      viewerId: this.currentUser.id,
      targetId: participantId,
      timestamp: Date.now()
    });
    
    // Subscribe to arrangement updates
    this.subscribeToArrangementUpdates(participantId);
  }
  
  async exitView() {
    if (!this.currentView) return;
    
    await this.channel.publish('viewer-left', {
      viewerId: this.currentUser.id,
      targetId: this.currentView.participantId,
      viewDuration: Date.now() - this.currentView.startTime
    });
    
    this.currentView = null;
    this.otherViewers.clear();
  }
}
```

### Interactive Elements
- [ ] **Card Inspection**: Hover to see full card descriptions
- [ ] **Zoom Controls**: Zoom in/out on arrangement for detail
- [ ] **Arrangement History**: Timeline of changes (if available)
- [ ] **Export Options**: Save/share viewed arrangement
- [ ] **Discussion Annotations**: Comments on specific cards (future)

### Navigation Features
- [ ] **Quick Switch Menu**: Dropdown to switch between revealed participants
- [ ] **Keyboard Shortcuts**: Arrow keys to navigate between participants
- [ ] **Breadcrumb Trail**: Show viewing history
- [ ] **Recent Views**: Quick access to recently viewed arrangements

### Performance Optimization
- [ ] **Efficient Rendering**: Only render visible cards
- [ ] **Update Batching**: Group multiple card updates
- [ ] **Memory Management**: Clean up viewer data on exit
- [ ] **Network Efficiency**: Minimize update frequency for viewers

## Live Update System
```javascript
// Handle real-time arrangement updates
class ArrangementSync {
  handleArrangementUpdate(update) {
    const { participantId, cardPositions, timestamp } = update;
    
    if (this.currentView?.participantId !== participantId) return;
    
    // Animate cards to new positions
    cardPositions.forEach(cardUpdate => {
      this.animateCardTo(cardUpdate.cardId, cardUpdate.x, cardUpdate.y);
    });
    
    // Highlight recently moved cards
    this.highlightRecentChanges(cardPositions, timestamp);
  }
  
  animateCardTo(cardId, x, y) {
    const card = document.getElementById(cardId);
    if (!card) return;
    
    card.style.transition = 'transform 300ms ease-out';
    card.style.transform = `translate(${x}px, ${y}px)`;
  }
}
```

### Viewer Presence Display
- [ ] **Avatar Stack**: Circular avatars with participant colors
- [ ] **Overflow Indicator**: "+3 others" when more than 5 viewers
- [ ] **Hover Expansion**: Show all viewer names on hover
- [ ] **Join/Leave Animation**: Smooth avatar transitions
- [ ] **Activity Indicators**: Show who is actively viewing vs idle

### Error Handling
- [ ] **Invalid Participant**: Handle viewing non-existent participants
- [ ] **Unrevealed Content**: Graceful handling of private arrangements
- [ ] **Connection Loss**: Maintain view state during reconnection
- [ ] **Sync Failures**: Retry failed arrangement updates
- [ ] **Navigation Errors**: Handle broken view transitions

### Mobile Considerations
- [ ] **Touch Navigation**: Swipe gestures for switching participants
- [ ] **Responsive Layout**: Adapt to smaller screens
- [ ] **Performance**: Optimize for mobile rendering
- [ ] **Battery Efficiency**: Reduce update frequency on mobile

## Accessibility Features
- [ ] **Screen Reader**: Describe arrangement layout and changes
- [ ] **Keyboard Navigation**: Full keyboard control for viewing
- [ ] **Focus Management**: Proper focus handling in view mode
- [ ] **High Contrast**: Ensure all elements visible in accessibility modes
- [ ] **Voice Descriptions**: Audio descriptions of arrangements

### Analytics Tracking
- [ ] **View Duration**: Track how long participants view others
- [ ] **Popular Views**: Which participants are viewed most
- [ ] **Engagement Patterns**: Common viewing flows and behaviors
- [ ] **Discussion Triggers**: Correlate views with reveal rates

## UI Components
```jsx
// Viewer mode header
function ViewerHeader({ participant, onBack, viewers }) {
  return (
    <header className="viewer-header">
      <button className="back-btn" onClick={onBack}>
        ‚Üê Back to Participants
      </button>
      <h1>{participant.name}'s Top {participant.revealType === 'top8' ? '8' : '3'} Leadership Values</h1>
      <ViewerAvatars viewers={viewers} />
    </header>
  );
}

// Viewer avatars component
function ViewerAvatars({ viewers }) {
  const visibleViewers = viewers.slice(0, 5);
  const overflowCount = Math.max(0, viewers.length - 5);
  
  return (
    <div className="viewer-avatars">
      {visibleViewers.map(viewer => (
        <div 
          key={viewer.id}
          className="viewer-avatar"
          style={{ backgroundColor: viewer.color }}
          title={viewer.name}
        >
          {viewer.emoji}
        </div>
      ))}
      {overflowCount > 0 && (
        <div className="viewer-overflow">+{overflowCount}</div>
      )}
    </div>
  );
}
```

### Security Considerations
- [ ] **Access Control**: Only session participants can enter viewer mode
- [ ] **Data Validation**: Validate all viewer messages
- [ ] **Privacy Respect**: Only show explicitly revealed arrangements
- [ ] **Session Boundaries**: Prevent cross-session viewing

## Acceptance Criteria
- [ ] Can enter full-screen viewer mode for any revealed participant
- [ ] Real-time updates show smoothly as owner moves cards
- [ ] Viewer presence accurately displays current viewers
- [ ] Navigation between different participants' reveals works seamlessly
- [ ] Back button returns to participants list correctly
- [ ] Performance remains smooth with multiple simultaneous viewers
- [ ] Mobile experience works with touch navigation
- [ ] Accessibility features function with screen readers

## Test Cases
1. Enter viewer mode and verify correct arrangement display
2. Test real-time updates while owner rearranges cards
3. Multiple viewers viewing same arrangement simultaneously
4. Navigate between different participants' revealed arrangements
5. Test viewer presence indicators and avatar display
6. Mobile viewer experience with touch navigation
7. Network interruption during viewing session
8. Invalid participant or unrevealed arrangement handling
9. Performance test with maximum viewers per arrangement
10. Accessibility testing with keyboard navigation and screen readers

## Dependencies
- 04.1 Ably Setup ‚úì
- 04.2 Participants Overview ‚úì
- 04.3 Reveal Mechanism ‚úì (reveals must exist to view)
- Event-driven architecture (EventBus, viewer events) ‚úì
- Session-scoped stores for viewer state ‚úì

## Status: üî¥ Not Started